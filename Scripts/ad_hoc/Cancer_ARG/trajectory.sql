create or replace view REPORTING.CANCER__ARG.TRAJECTORY(
	DATE,
	FIN_YEAR,
	FIN_MONTH_NAME,
	PROVIDER_CODE,
	PROVIDER_NAME,
	STANDARD,
	NUMERATOR,
	DENOMINATOR,
	TRAJECTORY_PERFORMANCE
) COMMENT='Performance trajectory for past and future months.\nContact: jake.kealey@nhs.net'
 as
SELECT
    DATE_FULL AS DATE,
    CASE 
        WHEN DATE_MONTH > 3 THEN CONCAT(DATE_YEAR, '/', DATE_YEAR-1999)
        ELSE CONCAT(DATE_YEAR - 1, '/', DATE_YEAR-2000)
    END AS FIN_YEAR,
    UPPER(TO_CHAR(DATE_FULL, 'MON')) AS FIN_MONTH_NAME,
    PROVIDER_CODE,
    PROVIDER_SHORTHAND AS PROVIDER_NAME,
    STANDARD,
    NUMERATOR,
    DENOMINATOR,
    CASE DENOMINATOR
        WHEN 0 THEN NULL
        ELSE DIV0(NUMERATOR, DENOMINATOR) 
    END AS TRAJECTORY_PERFORMANCE
FROM MODELLING.CANCER__CCO.CANCER_TRAJECTORY;